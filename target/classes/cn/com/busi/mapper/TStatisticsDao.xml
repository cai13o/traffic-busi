<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.busi.mapper.TStatisticsDao">

    <resultMap id="BaseResultMap" type="cn.com.busi.entity.TStatistics">
        <result property="hgl" column="hgl" jdbcType="VARCHAR"/>
        <result property="jcjl" column="jcjl" jdbcType="VARCHAR"/>
        <result property="jcjl" column="jyjl" jdbcType="VARCHAR"/>
        <result property="clzs" column="clzs" jdbcType="VARCHAR"/>
        <result property="syxz" column="syxz" jdbcType="VARCHAR"/>
        <result property="jcjgmc" column="jcjgmc" jdbcType="VARCHAR"/>
    </resultMap>

    <!--车辆总数查询-->
    <select id="carAll" resultMap="BaseResultMap">
        select
        COUNT(*) as clzs
        <trim prefix="," suffixOverrides=",">
            <if test="tStatistics.xzqy != null and tStatistics.xzqy != ''">
                ${tStatistics.xzqy},
            </if>
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                ${tStatistics.cllx},
            </if>
            <if test="tStatistics.ppxh != null and tStatistics.ppxh != ''">
                ${tStatistics.ppxh},
            </if>
            <if test="tStatistics.clrllb != null and tStatistics.clrllb != ''">
                ${tStatistics.clrllb},
            </if>
            <if test="tStatistics.jcjgmc != null and tStatistics.jcjgmc != ''">
                ${tStatistics.jcjgmc},
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                ${tStatistics.jcjl},
            </if>
            <if test="tStatistics.syxz != null and tStatistics.syxz != ''">
                ${tStatistics.syxz},
            </if>
            <if test="tStatistics.jyrq != null">
                ${tStatistics.jyrq},
            </if>
        </trim>
        from t_report
        <where>
            1 = 1 and zjcs = "1 "
            <if test="tReport.xzqy != null and tReport.xzqy != ''">
                and xzqy like concat(concat('%',#{tReport.xzqy}),'%')
            </if>
            <if test="tReport.cllx != null and tReport.cllx != ''">
                and cllx like concat(concat('%',#{tReport.cllx}),'%')
            </if>
            <if test="tReport.ppxh != null and tReport.ppxh != ''">
                and ppxh like concat(concat(#{tReport.ppxh}),'%')
            </if>
            <if test="tReport.jcjgmc != null and tReport.jcjgmc != ''">
                and jcjgmc like concat(concat('%',#{tReport.jcjgmc}),'%')
            </if>
            <if test="tReport.clrllb != null and tReport.clrllb != ''">
                and clrllb like concat(concat('%',#{tReport.clrllb}),'%')
            </if>
            <if test="tReport.jcjl != null and tReport.jcjl != ''">
                and jcjl = #{tReport.jcjl}
            </if>
            <if test="tReport.syxz != null and tReport.syxz != ''">
                and syxz like concat(concat('%',#{tReport.syxz}),'%')
            </if>
            <if test="tStatistics.startDate != null">
                and TO_DAYS(jcrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null">
                and TO_DAYS(jcrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>

        </where>
        <trim prefix="group by" suffixOverrides=",">
            <if test="tStatistics.xzqy != null and tStatistics.xzqy != ''">
                ${tStatistics.xzqy},
            </if>
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                ${tStatistics.cllx},
            </if>
            <if test="tStatistics.clrllb != null and tStatistics.clrllb != ''">
                ${tStatistics.clrllb},
            </if>
            <if test="tStatistics.jcjgmc != null and tStatistics.jcjgmc != ''">
                ${tStatistics.jcjgmc},
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                ${tStatistics.jcjl},
            </if>
            <if test="tStatistics.syxz != null and tStatistics.syxz != ''">
                ${tStatistics.syxz},
            </if>
        </trim>
    </select>

    <!--初审合格率查询-->
    <select id="firstSelect" resultMap="BaseResultMap">
        select
        COUNT(case when jcjl !='不合格' then 1 else null end)/COUNT(*) as hgl
        <trim prefix="," suffixOverrides=",">
            <if test="tStatistics.xzqy != null and tStatistics.xzqy != ''">
                ${tStatistics.xzqy},
            </if>
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                ${tStatistics.cllx},
            </if>
            <if test="tStatistics.ppxh != null and tStatistics.ppxh != ''">
                ${tStatistics.ppxh},
            </if>
            <if test="tStatistics.clrllb != null and tStatistics.clrllb != ''">
                ${tStatistics.clrllb},
            </if>
            <if test="tStatistics.jcjgmc != null and tStatistics.jcjgmc != ''">
                ${tStatistics.jcjgmc},
            </if>
            <if test="tStatistics.syxz != null and tStatistics.syxz != ''">
                ${tStatistics.syxz},
            </if>
            <if test="tStatistics.jyrq != null">
                ${tStatistics.jyrq},
            </if>
        </trim>
        from t_report
        <where>
            zjcs = "1"
            <if test="tReport.xzqy != null and tReport.xzqy != ''">
                and xzqy like concat(concat('%',#{tReport.xzqy}),'%')
            </if>
            <if test="tReport.cllx != null and tReport.cllx != ''">
                and cllx like concat(concat('%',#{tReport.cllx}),'%')
            </if>
            <if test="tReport.ppxh != null and tReport.ppxh != ''">
                and ppxh like concat(concat(#{tReport.ppxh}),'%')
            </if>
            <if test="tReport.jcjgmc != null and tReport.jcjgmc != ''">
                and jcjgmc like concat(concat('%',#{tReport.jcjgmc}),'%')
            </if>
            <if test="tReport.clrllb != null and tReport.clrllb != ''">
                and clrllb like concat(concat('%',#{tReport.clrllb}),'%')
            </if>
            <if test="tReport.jcjl != null and tReport.jcjl != ''">
                and jcjl like concat(concat('%',#{tReport.jcjl}),'%')
            </if>
            <if test="tReport.syxz != null and tReport.syxz != ''">
                and syxz like concat(concat('%',#{tReport.syxz}),'%')
            </if>
            <if test="tStatistics.startDate != null">
                and TO_DAYS(jcrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null">
                and TO_DAYS(jcrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>
        </where>
        <trim prefix="group by" suffixOverrides=",">
            <if test="tStatistics.xzqy != null and tStatistics.xzqy != ''">
                ${tStatistics.xzqy},
            </if>
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                ${tStatistics.cllx},
            </if>
            <if test="tStatistics.clrllb != null and tStatistics.clrllb != ''">
                ${tStatistics.clrllb},
            </if>
            <if test="tStatistics.jcjgmc != null and tStatistics.jcjgmc != ''">
                ${tStatistics.jcjgmc},
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                ${tStatistics.jcjl},
            </if>
            <if test="tStatistics.syxz != null and tStatistics.syxz != ''">
                ${tStatistics.syxz},
            </if>

        </trim>
    </select>

    <!--单项合格率查询查询-->
    <select id="singleSelect" resultMap="BaseResultMap">
        select
        COUNT(case when ${tStatistics.singlePass} !='不合格' then 1 else null
        end)/COUNT(*) as hgl
        <trim prefix="," suffixOverrides=",">
            <if test="tStatistics.xzqy != null and tStatistics.xzqy != ''">
                ${tStatistics.xzqy},
            </if>
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                ${tStatistics.cllx},
            </if>
            <if test="tStatistics.ppxh != null and tStatistics.ppxh != ''">
                ${tStatistics.ppxh},
            </if>
            <if test="tStatistics.clrllb != null and tStatistics.clrllb != ''">
                ${tStatistics.clrllb},
            </if>
            <if test="tStatistics.jcjgmc != null and tStatistics.jcjgmc != ''">
                ${tStatistics.jcjgmc},
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                ${tStatistics.jcjl},
            </if>
            <if test="tStatistics.syxz != null and tStatistics.syxz != ''">
                ${tStatistics.syxz},
            </if>
            <if test="tStatistics.jyrq != null ">
                ${tStatistics.jyrq},
            </if>
        </trim>
        from t_report
        <where>
            zcdjrq >= DATE_SUB(NOW(),INTERVAL 3 MONTH) or (${tStatistics.singlePass} !='-' AND ${tStatistics.singlePass} !='')
            <if test="tReport.xzqy != null and tReport.xzqy != ''">
                and xzqy like concat(concat('%',#{tReport.xzqy}),'%')
            </if>
            <if test="tReport.cllx != null and tReport.cllx != ''">
                and cllx like concat(concat('%',#{tReport.cllx}),'%')
            </if>
            <if test="tReport.ppxh != null and tReport.ppxh != ''">
                and ppxh like concat(concat(#{tReport.ppxh}),'%')
            </if>
            <if test="tReport.jcjgmc != null and tReport.jcjgmc != ''">
                and jcjgmc like concat(concat('%',#{tReport.jcjgmc}),'%')
            </if>
            <if test="tReport.clrllb != null and tReport.clrllb != ''">
                and clrllb like concat(concat('%',#{tReport.clrllb}),'%')
            </if>
            <if test="tReport.syxz != null and tReport.syxz != ''">
                and syxz like concat(concat('%',#{tReport.syxz}),'%')
            </if>
            <if test="tStatistics.startDate != null ">
                and TO_DAYS(jcrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null ">
                and TO_DAYS(jcrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>

        </where>
        <trim prefix="group by" suffixOverrides=",">
            <if test="tStatistics.xzqy != null  and tStatistics.xzqy != ''">
                ${tStatistics.xzqy},
            </if>
            <if test="tStatistics.cllx != null  and tStatistics.cllx != ''">
                ${tStatistics.cllx},
            </if>
            <if test="tStatistics.clrllb != null  and tStatistics.clrllb != ''">
                ${tStatistics.clrllb},
            </if>
            <if test="tStatistics.jcjgmc != null  and tStatistics.jcjgmc != ''">
                ${tStatistics.jcjgmc},
            </if>
             <if test="tStatistics.syxz != null  and tStatistics.syxz != ''">
                ${tStatistics.syxz},
            </if>
        </trim>
    </select>


    <select id="cllxStatistics" resultType="java.util.Map">
        SELECT count(1) num,cllx FROM t_report  GROUP BY cllx
    </select>


    <select id="firstStatistics" resultType="java.lang.Integer">
        SELECT
	        count(t_report.jcjl) AS num
        FROM
	        (
            select year(Now())-2 as years
            union
            select year(Now())-1 as years
            union
            select year(Now()) as years
	        ) AS years
        LEFT JOIN t_report ON YEAR(jcrq) = years.years and  t_report.jcjl !="不合格" and t_report.zjcs = "1"
        GROUP BY
	        years.years
    </select>

    <select id="firstNotStatistics" resultType="java.lang.Integer">
        SELECT
	        count(t_report.jcjl) AS num
        FROM
	        (
            select year(Now())-2 as years
            union
            select year(Now())-1 as years
            union
            select year(Now()) as years
	        ) AS years
        LEFT JOIN t_report ON YEAR(jcrq) = years.years and  t_report.jcjl ="不合格" and t_report.zjcs = "1"
        GROUP BY
	        years.years
    </select>

    <select id="count" resultType="java.lang.Integer" statementType="PREPARED">
        SELECT
	        count(*) AS num
        FROM
            ${table}
    </select>

    <!-- 单项合格数量统计 -->
    <select id="singleStatistics" resultType="java.lang.Integer">
        SELECT
	        count(${tSintype.id}) AS num
        FROM
	        (
            select year(Now())-2 as years
            union
            select year(Now())-1 as years
            union
            select year(Now()) as years
	        ) AS years
        LEFT JOIN t_report ON YEAR(jcrq) = years.years and ${tSintype.id} != "不合格" and ${tSintype.id} != "-"  and ${tSintype.id} !=""
        GROUP BY
	        years.years
    </select>

    <!-- 合格不合格统计 -->
    <select id="first" resultType="java.lang.Integer">
        SELECT
	        count(t_report.jcjl) AS num
        FROM
	        t_report
        <where>
            t_report.jcjl !="不合格" and t_report.zjcs = "1"
            <if test="tReport.xzqy != null and tReport.xzqy != ''">
                and xzqy = #{tReport.xzqy}
            </if>
            <if test="tReport.cllx != null and tReport.cllx != ''">
                and cllx = #{tReport.cllx}
            </if>
            <if test="tReport.ppxh != null and tReport.ppxh != ''">
                and ppxh like concat(concat(#{tReport.ppxh}),'%')
            </if>
            <if test="tReport.jcjgmc != null and tReport.jcjgmc != ''">
                and jcjgmc = #{tReport.jcjgmc}
            </if>
            <if test="tReport.clrllb != null and tReport.clrllb != ''">
                and clrllb = #{tReport.clrllb}
            </if>
            <if test="tReport.jcjl != null and tReport.jcjl != ''">
                and jcjl = #{tReport.jcjl}
            </if>
            <if test="tReport.syxz != null and tReport.syxz != ''">
                and syxz = #{tReport.syxz}
            </if>
            <if test="tStatistics.startDate != null">
                and TO_DAYS(jcrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null">
                and TO_DAYS(jcrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>
        </where>
    </select>

    <select id="firstNo" resultType="java.lang.Integer">
        SELECT
	        count(t_report.jcjl) AS num
        FROM
	        t_report
        <where>
            t_report.jcjl ="不合格" and t_report.zjcs = "1"
            <if test="tReport.xzqy != null and tReport.xzqy != ''">
                and xzqy = #{tReport.xzqy}
            </if>
            <if test="tReport.cllx != null and tReport.cllx != ''">
                and cllx = #{tReport.cllx}
            </if>
            <if test="tReport.ppxh != null and tReport.ppxh != ''">
                and ppxh like concat(concat(#{tReport.ppxh}),'%')
            </if>
            <if test="tReport.jcjgmc != null and tReport.jcjgmc != ''">
                and jcjgmc = #{tReport.jcjgmc}
            </if>
            <if test="tReport.clrllb != null and tReport.clrllb != ''">
                and clrllb = #{tReport.clrllb}
            </if>
            <if test="tReport.jcjl != null and tReport.jcjl != ''">
                and jcjl = #{tReport.jcjl}
            </if>
            <if test="tReport.syxz != null and tReport.syxz != ''">
                and syxz = #{tReport.syxz}
            </if>
            <if test="tStatistics.startDate != null">
                and TO_DAYS(jcrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null">
                and TO_DAYS(jcrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>
        </where>
    </select>


    <!-- 单项合格不合格统计 -->
    <select id="single" resultType="java.lang.Integer">
        SELECT
        count(t_report.jcjl) AS num
        FROM
        t_report
        <where>
            ${tStatistics.singlePass} !='不合格' and ${tStatistics.singlePass} !='-' and ${tStatistics.singlePass} !=''
            <if test="tReport.xzqy != null and tReport.xzqy != ''">
                and xzqy = #{tReport.xzqy}
            </if>
            <if test="tReport.cllx != null and tReport.cllx != ''">
                and cllx = #{tReport.cllx}
            </if>
            <if test="tReport.ppxh != null and tReport.ppxh != ''">
                and ppxh like concat(concat(#{tReport.ppxh}),'%')
            </if>
            <if test="tReport.jcjgmc != null and tReport.jcjgmc != ''">
                and jcjgmc = #{tReport.jcjgmc}
            </if>
            <if test="tReport.clrllb != null and tReport.clrllb != ''">
                and clrllb = #{tReport.clrllb}
            </if>
            <if test="tReport.jcjl != null and tReport.jcjl != ''">
                and jcjl = #{tReport.jcjl}
            </if>
            <if test="tReport.syxz != null and tReport.syxz != ''">
                and syxz = #{tReport.syxz}
            </if>
            <if test="tStatistics.startDate != null">
                and TO_DAYS(jcrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null">
                and TO_DAYS(jcrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>
        </where>
    </select>

    <select id="singleNo" resultType="java.lang.Integer">
        SELECT
        count(t_report.jcjl) AS num
        FROM
        t_report
        <where>
            ${tStatistics.singlePass} ='不合格'
            <if test="tReport.xzqy != null and tReport.xzqy != ''">
                and xzqy = #{tReport.xzqy}
            </if>
            <if test="tReport.cllx != null and tReport.cllx != ''">
                and cllx = #{tReport.cllx}
            </if>
            <if test="tReport.ppxh != null and tReport.ppxh != ''">
                and ppxh like concat(concat(#{tReport.ppxh}),'%')
            </if>
            <if test="tReport.jcjgmc != null and tReport.jcjgmc != ''">
                and jcjgmc = #{tReport.jcjgmc}
            </if>
            <if test="tReport.clrllb != null and tReport.clrllb != ''">
                and clrllb = #{tReport.clrllb}
            </if>
            <if test="tReport.jcjl != null and tReport.jcjl != ''">
                and jcjl = #{tReport.jcjl}
            </if>
            <if test="tReport.syxz != null and tReport.syxz != ''">
                and syxz = #{tReport.syxz}
            </if>
            <if test="tStatistics.startDate != null">
                and TO_DAYS(jcrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null">
                and TO_DAYS(jcrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>
        </where>
    </select>
    <!-- 按等级划分车辆数-->
    <select id="jcjlByAll" resultMap="BaseResultMap">
        select
            COUNT(*) as clzs,jcjl
        from t_report
        where zjcs = "1 "
		group by jcjl
    </select>

    <!-- 按使用性质划分合格率-->
    <select id="syxzByAll" resultMap="BaseResultMap">
        select
            COUNT(case when jcjl !='不合格' then 1 else null end)/COUNT(*) as hgl,syxz
        from t_report
        where
            zjcs = "1"
		GROUP BY syxz
		ORDER BY hgl
    </select>


    <!-- ================================================================================================================================= -->

    <!--车辆总数查询-->
    <select id="carAllNow" resultMap="BaseResultMap">
        select
        COUNT(*) as clzs
        <trim prefix="," suffixOverrides=",">
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                t_inspection_report.${tStatistics.cllx},
            </if>
            <if test="tStatistics.ppxh != null and tStatistics.ppxh != ''">
                t_inspection_report.${tStatistics.ppxh},
            </if>
            <if test="tStatistics.rllb != null and tStatistics.rllb != ''">
                t_inspection_instrument.${tStatistics.rllb} clrllb,
            </if>
            <if test="tStatistics.jcjgmc != null and tStatistics.jcjgmc != ''">
                t_inspection_report.${tStatistics.jcjgmc} jcjgmc,
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                t_inspection_report.${tStatistics.jcjl} jcjl,
            </if>
            <if test="tStatistics.syxz != null and tStatistics.syxz != ''">
                t_inspection_report.${tStatistics.syxz},
            </if>
            <if test="tStatistics.jyrq != null">
                t_inspection_report.${tStatistics.jyrq},
            </if>
        </trim>
        from t_inspection_report
        left join t_inspection_instrument on t_inspection_report.id = t_inspection_instrument.id
        <where>
            1 = 1 and t_inspection_instrument.zjcs = "1 "
            <if test="tInspectionReport.cllx != null and tInspectionReport.cllx != ''">
                and t_inspection_report.cllx like concat(concat('%',#{tInspectionReport.cllx}),'%')
            </if>
            <if test="tInspectionReport.ppxh != null and tInspectionReport.ppxh != ''">
                and t_inspection_report.ppxh like concat(concat(#{tInspectionReport.ppxh}),'%')
            </if>
            <if test="tInspectionReport.jyjgmc != null and tInspectionReport.jyjgmc != ''">
                and t_inspection_report.jyjgmc like concat(concat('%',#{tInspectionReport.jyjgmc}),'%')
            </if>
            <if test="tInspectionReport.rllb != null and tInspectionReport.rllb != ''">
                and t_inspection_instrument.rllb like concat(concat('%',#{tInspectionReport.rllb}),'%')
            </if>
            <if test="tInspectionReport.jyjl != null and tInspectionReport.jyjl != ''">
                and t_inspection_report.jyjl = #{tInspectionReport.jyjl}
            </if>
            <if test="tInspectionReport.syxz != null and tInspectionReport.syxz != ''">
                and t_inspection_report.syxz like concat(concat('%',#{tInspectionReport.syxz}),'%')
            </if>
            <if test="tStatistics.startDate != null">
                and TO_DAYS(t_inspection_report.jyrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null">
                and TO_DAYS(t_inspection_report.jyrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>
        </where>
        <trim prefix="group by" suffixOverrides=",">
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                t_inspection_report.${tStatistics.cllx},
            </if>
            <if test="tStatistics.rllb != null and tStatistics.rllb != ''">
                t_inspection_instrument.${tStatistics.rllb},
            </if>
            <if test="tStatistics.jcjgmc != null and tStatistics.jcjgmc != ''">
                t_inspection_report.${tStatistics.jcjgmc},
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                t_inspection_report.${tStatistics.jcjl},
            </if>
            <if test="tStatistics.syxz != null and tStatistics.syxz != ''">
                t_inspection_report.${tStatistics.syxz},
            </if>
        </trim>
    </select>

    <!--初审合格率查询-->
    <select id="firstSelectNow" resultMap="BaseResultMap">
        select
        COUNT(case when t_inspection_report.jyjl !='不合格' then 1 else null end)/COUNT(*) as hgl
        <trim prefix="," suffixOverrides=",">
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                t_inspection_report.${tStatistics.cllx},
            </if>
            <if test="tStatistics.ppxh != null and tStatistics.ppxh != ''">
                t_inspection_report.${tStatistics.ppxh},
            </if>
            <if test="tStatistics.rllb != null and tStatistics.rllb != ''">
                t_inspection_instrument.${tStatistics.rllb} clrllb,
            </if>
            <if test="tStatistics.jcjgmc != null and tStatistics.jcjgmc != ''">
                t_inspection_report.${tStatistics.jcjgmc} jcjgmc,
            </if>
            <if test="tStatistics.syxz != null and tStatistics.syxz != ''">
                t_inspection_report.${tStatistics.syxz},
            </if>
            <if test="tStatistics.jyrq != null">
                t_inspection_report.${tStatistics.jyrq},
            </if>
        </trim>
        from t_inspection_report
        left join t_inspection_instrument on t_inspection_report.id = t_inspection_instrument.id
        <where>
            t_inspection_instrument.zjcs = "1"
            <if test="tInspectionReport.cllx != null and tInspectionReport.cllx != ''">
                and t_inspection_report.cllx like concat(concat('%',#{tInspectionReport.cllx}),'%')
            </if>
            <if test="tInspectionReport.ppxh != null and tInspectionReport.ppxh != ''">
                and t_inspection_report.ppxh like concat(concat(#{tInspectionReport.ppxh}),'%')
            </if>
            <if test="tInspectionReport.jyjgmc != null and tInspectionReport.jyjgmc != ''">
                and t_inspection_report.jyjgmc like concat(concat('%',#{tInspectionReport.jyjgmc}),'%')
            </if>
            <if test="tInspectionReport.rllb != null and tInspectionReport.rllb != ''">
                and t_inspection_instrument.rllb like concat(concat('%',#{tInspectionReport.rllb}),'%')
            </if>
            <if test="tInspectionReport.jyjl != null and tInspectionReport.jyjl != ''">
                and t_inspection_report.jcjl = #{tInspectionReport.jyjl}
            </if>
            <if test="tInspectionReport.syxz != null and tInspectionReport.syxz != ''">
                and t_inspection_report.syxz like concat(concat('%',#{tInspectionReport.syxz}),'%')
            </if>
            <if test="tStatistics.startDate != null">
                and TO_DAYS(t_inspection_report.jyrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null">
                and TO_DAYS(t_inspection_report.jyrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>
        </where>
        <trim prefix="group by" suffixOverrides=",">
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                t_inspection_report.${tStatistics.cllx},
            </if>
            <if test="tStatistics.rllb != null and tStatistics.rllb != ''">
                t_inspection_instrument.${tStatistics.rllb},
            </if>
            <if test="tStatistics.jcjgmc != null and tStatistics.jcjgmc != ''">
                t_inspection_report.${tStatistics.jcjgmc},
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                t_inspection_report.${tStatistics.jcjl},
            </if>
            <if test="tStatistics.syxz != null and tStatistics.syxz != ''">
                t_inspection_report.${tStatistics.syxz},
            </if>
        </trim>
    </select>

    <!--单项合格率查询查询-->
    <select id="singleSelectNow" resultMap="BaseResultMap">
        select
        COUNT(case when substring_index(t_instrument_result.jgpd,${tStatistics.singlePass}) !='不合格' then 1 else null
        end)/COUNT(*) as hgl
        <trim prefix="," suffixOverrides=",">
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                t_inspection_report.${tStatistics.cllx},
            </if>
            <if test="tStatistics.ppxh != null and tStatistics.ppxh != ''">
                t_inspection_report.${tStatistics.ppxh},
            </if>
            <if test="tStatistics.rllb != null and tStatistics.rllb != ''">
                t_inspection_instrument.${tStatistics.rllb} clrllb,
            </if>
            <if test="tStatistics.jcjgmc != null and tStatistics.jcjgmc != ''">
                t_inspection_report.${tStatistics.jcjgmc} jcjgmc,
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                t_inspection_instrument.${tStatistics.jcjl} jcjl,
            </if>
            <if test="tStatistics.syxz != null and tStatistics.syxz != ''">
                t_inspection_report.${tStatistics.syxz},
            </if>
            <if test="tStatistics.jyrq != null ">
                t_inspection_report.${tStatistics.jyrq},
            </if>
        </trim>
        from t_inspection_report
        left join t_inspection_instrument on t_inspection_report.id = t_inspection_instrument.id
		left join t_instrument_result on t_inspection_instrument.id = t_instrument_result.rid
        <where>
            t_inspection_instrument.ccdjrq >= DATE_SUB(NOW(),INTERVAL 3 MONTH) or (t_instrument_result.jgpd !='-' AND t_instrument_result.jgpd !='')
			and (
			<if test="concat2 != null and concat2 != ''">
			t_instrument_result.jyxm like concat(concat('%',#{concat2}),'%') OR
			</if>
			t_instrument_result.jyxm like concat(concat('%',#{concat1}),'%'))
            <if test="tInspectionReport.cllx != null and tInspectionReport.cllx != ''">
                and t_inspection_report.cllx like concat(concat('%',#{tInspectionReport.cllx}),'%')
            </if>
            <if test="tInspectionReport.ppxh != null and tInspectionReport.ppxh != ''">
                and t_inspection_report.ppxh like concat(concat(#{tInspectionReport.ppxh}),'%')
            </if>
            <if test="tInspectionReport.jyjgmc != null and tInspectionReport.jyjgmc != ''">
                and t_inspection_report.jyjgmc like concat(concat('%',#{tInspectionReport.jyjgmc}),'%')
            </if>
            <if test="tInspectionReport.rllb != null and tInspectionReport.rllb != ''">
                and t_inspection_instrument.rllb like concat(concat('%',#{tInspectionReport.rllb}),'%')
            </if>
            <if test="tInspectionReport.jyjl != null and tInspectionReport.jyjl != ''">
                and t_inspection_report.jyjl = #{tInspectionReport.jyjl}
            </if>
            <if test="tInspectionReport.syxz != null and tInspectionReport.syxz != ''">
                and t_inspection_report.syxz like concat(concat('%',#{tInspectionReport.syxz}),'%')
            </if>
            <if test="tStatistics.startDate != null ">
                and TO_DAYS(t_inspection_report.jyrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null ">
                and TO_DAYS(t_inspection_report.jyrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>
        </where>
        <trim prefix="group by" suffixOverrides=",">
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                t_inspection_report.${tStatistics.cllx},
            </if>
            <if test="tStatistics.rllb != null and tStatistics.rllb != ''">
                t_inspection_instrument.${tStatistics.rllb},
            </if>
            <if test="tStatistics.jcjgmc != null and tStatistics.jcjgmc != ''">
                t_inspection_report.${tStatistics.jcjgmc},
            </if>
             <if test="tStatistics.syxz != null and tStatistics.syxz != ''">
                t_inspection_report.${tStatistics.syxz},
            </if>
        </trim>
    </select>

     <select id="cllxStatisticsNow" resultType="java.util.Map">
        SELECT count(1) num,cllx FROM t_inspection_report  GROUP BY cllx
    </select>


    <select id="firstStatisticsNow" resultType="java.lang.Integer">
        SELECT
	        count(t_inspection_report.jyjl) AS num
        FROM
	        (
            select year(Now())-2 as years
            union
            select year(Now())-1 as years
            union
            select year(Now()) as years
	        ) AS years
        LEFT JOIN t_inspection_report ON YEAR(jyrq) = years.years and  t_inspection_report.jyjl !="不合格"
        left join t_inspection_instrument on t_inspection_report.id = t_inspection_instrument.id
        and t_inspection_instrument.zjcs = "1"
        GROUP BY
	        years.years
    </select>

    <select id="firstNotStatisticsNow" resultType="java.lang.Integer">
        SELECT
	        count(t_inspection_report.jyjl) AS num
        FROM
	        (
            select year(Now())-2 as years
            union
            select year(Now())-1 as years
            union
            select year(Now()) as years
	        ) AS years
        LEFT JOIN t_inspection_report ON YEAR(jyrq) = years.years and  t_inspection_report.jyjl ="不合格"
        left join t_inspection_instrument on t_inspection_report.id = t_inspection_instrument.id
        and t_inspection_instrument.zjcs = "1"
        GROUP BY
	        years.years
    </select>

    <select id="countNow" resultType="java.lang.Integer" statementType="PREPARED">
        SELECT
	        count(*) AS num
        FROM
            ${table}
    </select>

    <!-- 单项合格数量统计 -->
    <select id="singleStatisticsNow" resultType="java.lang.Integer">
    SELECT
	COUNT(
	CASE
			WHEN substring_index( t_instrument_result.jgpd,${concat3}) = '合格' THEN
				1 ELSE NULL
			END
			) AS num
		FROM
			( SELECT YEAR ( Now())- 2 AS years UNION SELECT YEAR ( Now())- 1 AS years UNION SELECT YEAR ( Now()) AS years ) AS years
			LEFT JOIN t_inspection_instrument ON YEAR ( t_inspection_instrument.jyrq ) = years.years
			LEFT JOIN t_instrument_result ON t_inspection_instrument.id = t_instrument_result.rid
			AND (
			<if test="concat2 != null and concat2 != ''">
			t_instrument_result.jyxm like concat(concat('%',#{concat2}),'%') OR
			</if>
			t_instrument_result.jyxm like concat(concat('%',#{concat1}),'%'))
	GROUP BY
	years.years
    </select>

    <!-- 合格不合格统计 -->
    <select id="firstNow" resultType="java.lang.Integer">
        SELECT
	        count(t_inspection_report.jyjl) AS num
        FROM
	        t_inspection_report
	    left join t_inspection_instrument on t_inspection_report.id = t_inspection_instrument.id
        <where>
            t_inspection_report.jyjl !="不合格" and t_inspection_instrument.zjcs = "1"
            <if test="tInspectionReport.cllx != null and tInspectionReport.cllx != ''">
                and t_inspection_report.cllx = #{tInspectionReport.cllx}
            </if>
            <if test="tInspectionReport.ppxh != null and tInspectionReport.ppxh != ''">
                and t_inspection_report.ppxh like concat(concat(#{tInspectionReport.ppxh}),'%')
            </if>
            <if test="tInspectionReport.jyjgmc != null and tInspectionReport.jyjgmc != ''">
                and t_inspection_report.jyjgmc = #{tInspectionReport.jyjgmc}
            </if>
            <if test="tInspectionReport.rllb != null and tInspectionReport.rllb != ''">
                and t_inspection_instrument.rllb = #{tInspectionReport.rllb}
            </if>
            <if test="tInspectionReport.jyjl != null and tInspectionReport.jyjl != ''">
                and t_inspection_report.jyjl = #{tInspectionReport.jyjl}
            </if>
            <if test="tInspectionReport.syxz != null and tInspectionReport.syxz != ''">
                and t_inspection_report.syxz = #{tInspectionReport.syxz}
            </if>
            <if test="tStatistics.startDate != null">
                and TO_DAYS(t_inspection_report.jyrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null">
                and TO_DAYS(t_inspection_report.jyrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>
        </where>
    </select>

    <select id="firstNoNow" resultType="java.lang.Integer">
        SELECT
	        count(t_inspection_report.jyjl) AS num
        FROM
	        t_inspection_report
	    left join t_inspection_instrument on t_inspection_report.id = t_inspection_instrument.id
        <where>
            t_inspection_report.jyjl ="不合格" and t_inspection_instrument.zjcs = "1"
                   <if test="tInspectionReport.cllx != null and tInspectionReport.cllx != ''">
                and t_inspection_report.cllx = #{tInspectionReport.cllx}
            </if>
            <if test="tInspectionReport.ppxh != null and tInspectionReport.ppxh != ''">
                and t_inspection_report.ppxh like concat(concat(#{tInspectionReport.ppxh}),'%')
            </if>
            <if test="tInspectionReport.jyjgmc != null and tInspectionReport.jyjgmc != ''">
                and t_inspection_report.jyjgmc = #{tInspectionReport.jyjgmc}
            </if>
            <if test="tInspectionReport.rllb != null and tInspectionReport.rllb != ''">
                and t_inspection_instrument.rllb = #{tInspectionReport.rllb}
            </if>
            <if test="tInspectionReport.jyjl != null and tInspectionReport.jyjl != ''">
                and t_inspection_report.jyjl = #{tInspectionReport.jyjl}
            </if>
            <if test="tInspectionReport.syxz != null and tInspectionReport.syxz != ''">
                and t_inspection_report.syxz = #{tInspectionReport.syxz}
            </if>
            <if test="tStatistics.startDate != null">
                and TO_DAYS(t_inspection_report.jyrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null">
                and TO_DAYS(t_inspection_report.jyrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>
        </where>
    </select>


    <!-- 单项合格不合格统计 -->
    <select id="singleNow" resultType="java.lang.Integer">
        SELECT
        COUNT(CASE
			WHEN substring_index( t_instrument_result.jgpd,${tStatistics.singlePass}) = '合格' THEN
				1 ELSE NULL
			END
			) AS num
        from t_inspection_report
        left join t_inspection_instrument on t_inspection_report.id = t_inspection_instrument.id
		left join t_instrument_result on t_inspection_instrument.id = t_instrument_result.rid
        <where>
            (
			<if test="concat2 != null and concat2 != ''">
			t_instrument_result.jyxm like concat(concat('%',#{concat2}),'%') OR
			</if>
			t_instrument_result.jyxm like concat(concat('%',#{concat1}),'%'))
            <if test="tInspectionReport.cllx != null and tInspectionReport.cllx != ''">
                and t_inspection_report.cllx = #{tInspectionReport.cllx}
            </if>
            <if test="tInspectionReport.ppxh != null and tInspectionReport.ppxh != ''">
                and t_inspection_report.ppxh like concat(concat(#{tInspectionReport.ppxh}),'%')
            </if>
            <if test="tInspectionReport.jyjgmc != null and tInspectionReport.jyjgmc != ''">
                and t_inspection_report.jyjgmc = #{tInspectionReport.jyjgmc}
            </if>
            <if test="tInspectionReport.rllb != null and tInspectionReport.rllb != ''">
                and t_inspection_instrument.rllb = #{tInspectionReport.rllb}
            </if>
            <if test="tInspectionReport.jyjl != null and tInspectionReport.jyjl != ''">
                and t_inspection_report.jyjl = #{tInspectionReport.jyjl}
            </if>
            <if test="tInspectionReport.syxz != null and tInspectionReport.syxz != ''">
                and t_inspection_report.syxz = #{tInspectionReport.syxz}
            </if>
            <if test="tStatistics.startDate != null">
                and TO_DAYS(t_inspection_report.jyrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null">
                and TO_DAYS(t_inspection_report.jyrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>
        </where>
    </select>

    <select id="singleNoNow" resultType="java.lang.Integer">
        SELECT
        COUNT(CASE
			WHEN substring_index( t_instrument_result.jgpd,${tStatistics.singlePass}) = '不合格' THEN
				1 ELSE NULL
			END
			) AS num
        from t_inspection_report
        left join t_inspection_instrument on t_inspection_report.id = t_inspection_instrument.id
		left join t_instrument_result on t_inspection_instrument.id = t_instrument_result.rid
        <where>
            (
			<if test="concat2 != null and concat2 != ''">
			t_instrument_result.jyxm like concat(concat('%',#{concat2}),'%') OR
			</if>
			t_instrument_result.jyxm like concat(concat('%',#{concat1}),'%'))
            <if test="tInspectionReport.cllx != null and tInspectionReport.cllx != ''">
                and t_inspection_report.cllx = #{tInspectionReport.cllx}
            </if>
            <if test="tInspectionReport.ppxh != null and tInspectionReport.ppxh != ''">
                and t_inspection_report.ppxh like concat(concat(#{tInspectionReport.ppxh}),'%')
            </if>
            <if test="tInspectionReport.jyjgmc != null and tInspectionReport.jyjgmc != ''">
                and t_inspection_report.jyjgmc = #{tInspectionReport.jyjgmc}
            </if>
            <if test="tInspectionReport.rllb != null and tInspectionReport.rllb != ''">
                and t_inspection_instrument.rllb = #{tInspectionReport.rllb}
            </if>
            <if test="tInspectionReport.jyjl != null and tInspectionReport.jyjl != ''">
                and t_inspection_report.jyjl = #{tInspectionReport.jyjl}
            </if>
            <if test="tInspectionReport.syxz != null and tInspectionReport.syxz != ''">
                and t_inspection_report.syxz = #{tInspectionReport.syxz}
            </if>
            <if test="tStatistics.startDate != null">
                and TO_DAYS(t_inspection_report.jyrq) &gt;= TO_DAYS(#{tStatistics.startDate})
            </if>
            <if test="tStatistics.endDate != null">
                and TO_DAYS(t_inspection_report.jyrq) &lt;= TO_DAYS(#{tStatistics.endDate})
            </if>
        </where>
    </select>
    <!-- 按等级划分车辆数-->
    <select id="jcjlByAllNow" resultMap="BaseResultMap">
        select
            COUNT(*) as clzs,t_inspection_report.jyjl
        from t_inspection_report
        left join t_inspection_instrument on t_inspection_report.id = t_inspection_instrument.id
        where t_inspection_instrument.zjcs = "1 "
		group by t_inspection_report.jyjl
    </select>

    <!-- 按使用性质划分合格率-->
    <select id="syxzByAllNow" resultMap="BaseResultMap">
        select
            COUNT(case when jyjl !='不合格' then 1 else null end)/COUNT(*) as hgl,syxz
        from t_inspection_report
        left join t_inspection_instrument on t_inspection_report.id = t_inspection_instrument.id
        where
            t_inspection_instrument.zjcs = "1"
		GROUP BY syxz
		ORDER BY hgl
    </select>
</mapper>