<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.busi.mapper.TReportDao">

    <resultMap id="GetResultMap" type="java.util.Map">
        <!--@Table t_report-->
        <result property="id" column="id" jdbcType="VARCHAR"/>
        <result property="cllx" column="cllx" jdbcType="VARCHAR"/>
        <result property="ppxh" column="ppxh" jdbcType="VARCHAR"/>
        <result property="xzqy" column="xzqy" jdbcType="VARCHAR"/>
        <result property="hgl" column="hgl" jdbcType="VARCHAR"/>
        <result property="rllb" column="rllb" jdbcType="VARCHAR"/>
        <result property="jyjgmc" column="jyjgmc" jdbcType="VARCHAR"/>
        <result property="jcjl" column="jcjl" jdbcType="VARCHAR"/>
        <result property="jcrq" column="jcrq" jdbcType="VARCHAR"/>
        <result property="clzs" column="clzs" jdbcType="VARCHAR"/>
    </resultMap>

    <!--车辆总数查询-->
    <select id="carAll" resultMap="GetResultMap">
        select
        COUNT(*) as clzs
        <trim prefix="," prefixOverrides=",">
            <if test="tStatistics.xzqy != null and tStatistics.xzqy != ''">
                ${tStatistics.xzqy}
            </if>
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                ${tStatistics.cllx}
            </if>
            <if test="tStatistics.ppxh != null and tStatistics.ppxh != ''">
                ${tStatistics.ppxh}
            </if>
            <if test="tStatistics.rllb != null and tStatistics.rllb != ''">
                ${tStatistics.rllb}
            </if>
            <if test="tStatistics.jyjgmc != null and tStatistics.jyjgmc != ''">
                ${tStatistics.jyjgmc}
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                ${tStatistics.jcjl}
            </if>
            <if test="tStatistics.jcrq != null and tStatistics.jcrq != ''">
                ${tStatistics.jcrq}
            </if>
        </trim>
        from t_report t,t_record d
        <where>
            t.bgbh=d.jyjgbh
            <if test="tReport.xzqy != null and tReport.xzqy != ''">
                and xzqy like concat(concat('%',#{tReport.xzqy}),'%')
            </if>
            <if test="tReport.cllx != null and tReport.cllx != ''">
                and cllx like concat(concat('%',#{tReport.cllx}),'%')
            </if>
            <if test="tReport.ppxh != null and tReport.ppxh != ''">
                and ppxh like concat(concat('%',#{tReport.ppxh}),'%')
            </if>
            <if test="tRecord.jyjgmc != null and tRecord.jyjgmc != ''">
                and jyjgmc like concat(concat('%',#{tRecord.jyjgmc}),'%')
            </if>
            <if test="tRecord.clrllb != null and tRecord.rllb != ''">
                and rllb like concat(concat('%',#{tRecord.rllb}),'%')
            </if>
            <if test="tStatistics.startDate != null and tStatistics.startDate != ''">
                and jcrq  &gt;= ${tStatistics.startDate}
            </if>
            <if test="tStatistics.endDate != null and tStatistics.endDate != ''">
                and jcrq  &gt;= ${tStatistics.endDate}
            </if>
        </where>
        <trim prefix="group by" prefixOverrides=",">
            <if test="tStatistics.xzqy != null and tStatistics.xzqy != ''">
                ${tStatistics.xzqy}
            </if>
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                ${tStatistics.cllx}
            </if>
            <if test="tStatistics.ppxh != null and tStatistics.ppxh != ''">
                ${tStatistics.ppxh}
            </if>
            <if test="tStatistics.rllb != null and tStatistics.rllb != ''">
                ${tStatistics.rllb}
            </if>
            <if test="tStatistics.jyjgmc != null and tStatistics.jyjgmc != ''">
                ${tStatistics.jyjgmc}
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                ${tStatistics.jcjl}
            </if>
            <if test="tStatistics.jcrq != null and tStatistics.jcrq != ''">
                ${tStatistics.jcrq}
            </if>
        </trim>
    </select>

    <!--初审合格率查询-->
    <select id="firstSelect" resultMap="GetResultMap">
        select
        COUNT(case when jcjl !='不合格' then 1 else null end)/COUNT(*) as hgl
        <trim prefix="," prefixOverrides=",">
            <if test="tStatistics.xzqy != null and tStatistics.xzqy != ''">
                ${tStatistics.xzqy}
            </if>
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                ${tStatistics.cllx}
            </if>
            <if test="tStatistics.ppxh != null and tStatistics.ppxh != ''">
                ${tStatistics.ppxh}
            </if>
            <if test="tStatistics.rllb != null and tStatistics.rllb != ''">
                ${tStatistics.rllb}
            </if>
            <if test="tStatistics.jyjgmc != null and tStatistics.jyjgmc != ''">
                ${tStatistics.jyjgmc}
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                ${tStatistics.jcjl}
            </if>
            <if test="tStatistics.jcrq != null and tStatistics.jcrq != ''">
                ${tStatistics.jcrq}
            </if>
        </trim>
        from t_report t,t_record d
        <where>
            t.bgbh=d.jyjgbh
            <if test="tReport.xzqy != null and tReport.xzqy != ''">
                and xzqy like concat(concat('%',#{tReport.xzqy}),'%')
            </if>
            <if test="tReport.cllx != null and tReport.cllx != ''">
                and cllx like concat(concat('%',#{tReport.cllx}),'%')
            </if>
            <if test="tReport.ppxh != null and tReport.ppxh != ''">
                and ppxh like concat(concat('%',#{tReport.ppxh}),'%')
            </if>
            <if test="tRecord.jyjgmc != null and tRecord.jyjgmc != ''">
                and jyjgmc like concat(concat('%',#{tRecord.jyjgmc}),'%')
            </if>
            <if test="tRecord.rllb != null and tRecord.rllb != ''">
                and rllb like concat(concat('%',#{tRecord.rllb}),'%')
            </if>
            <if test="tReport.jcjl != null and tReport.jcjl != ''">
                and jcjl like concat(concat('%',#{tReport.jcjl}),'%')
            </if>
            <if test="tStatistics.startDate != null and tStatistics.startDate != ''">
                and jcrq  &gt;= ${tStatistics.startDate}
            </if>
            <if test="tStatistics.endDate != null and tStatistics.endDate != ''">
                and jcrq  &gt;= ${tStatistics.endDate}
            </if>
        </where>
        <trim prefix="group by" prefixOverrides=",">
            <if test="tStatistics.xzqy != null and tStatistics.xzqy != ''">
                ${tStatistics.xzqy}
            </if>
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''" >
                ${tStatistics.cllx}
            </if>
            <if test="tStatistics.ppxh != null and tStatistics.ppxh != ''">
                ${tStatistics.ppxh}
            </if>
            <if test="tStatistics.rllb != null and tStatistics.rllb != ''">
                ${tStatistics.rllb}
            </if>
            <if test="tStatistics.jyjgmc != null and tStatistics.jyjgmc != ''">
                ${tStatistics.jyjgmc}
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                ${tStatistics.jcjl}
            </if>
            <if test="tStatistics.jcrq != null and tStatistics.jcrq != ''">
                ${tStatistics.jcrq}
            </if>
        </trim>
    </select>

    <!--单项合格率查询查询-->
    <select id="singleSelect" resultMap="GetResultMap">
        select
        COUNT(case when ${tStatistics.hgl} !='不合格' AND ${tStatistics.hgl} !='-' then 1 else null end)/COUNT(*) as hgl
        <trim prefix="," prefixOverrides=",">
            <if test="tStatistics.xzqy != null and tStatistics.xzqy != ''">
                ${tStatistics.xzqy}
            </if>
            <if test="tStatistics.cllx != null and tStatistics.cllx != ''">
                ${tStatistics.cllx}
            </if>
            <if test="tStatistics.ppxh != null and tStatistics.ppxh != ''">
                ${tStatistics.ppxh}
            </if>
            <if test="tStatistics.rllb != null and tStatistics.rllb != ''">
                ${tStatistics.rllb}
            </if>
            <if test="tStatistics.jyjgmc != null and tStatistics.jyjgmc != ''">
                ${tStatistics.jyjgmc}
            </if>
            <if test="tStatistics.jcjl != null and tStatistics.jcjl != ''">
                ${tStatistics.jcjl}
            </if>
            <if test="tStatistics.jcrq != null and tStatistics.jcrq != ''">
                ${tStatistics.jcrq}
            </if>
        </trim>
        from t_report t,t_record d
        <where>
            t.bgbh=d.jyjgbh
            <if test="tReport.xzqy != null and tReport.xzqy != ''">
                and xzqy like concat(concat('%',#{tReport.xzqy}),'%')
            </if>
            <if test="tReport.cllx != null and tReport.cllx != ''">
                and cllx like concat(concat('%',#{tReport.cllx}),'%')
            </if>
            <if test="tReport.ppxh != null and tReport.ppxh != ''">
                and ppxh like concat(concat('%',#{tReport.ppxh}),'%')
            </if>
            <if test="tRecord.jyjgmc != null and tRecord.jyjgmc != ''">
                and jyjgmc like concat(concat('%',#{tRecord.jyjgmc}),'%')
            </if>
            <if test="tRecord.rllb != null and tRecord.rllb != ''">
                and rllb like concat(concat('%',#{tRecord.rllb}),'%')
            </if>
            <if test="tStatistics.startDate != null and tStatistics.startDate != ''">
                and jcrq  &gt;= ${tStatistics.startDate}
            </if>
            <if test="tStatistics.endDate != null and tStatistics.endDate != ''">
                and jcrq  &gt;= ${tStatistics.endDate}
            </if>
        </where>
        <trim prefix="group by" prefixOverrides=",">
            <if test="tStatistics.xzqy != null  and tStatistics.xzqy != ''">
                ${tStatistics.xzqy}
            </if>
            <if test="tStatistics.cllx != null  and tStatistics.cllx != ''">
                ${tStatistics.cllx}
            </if>
            <if test="tStatistics.ppxh != null  and tStatistics.ppxh != ''">
                ${tStatistics.ppxh}
            </if>
            <if test="tStatistics.rllb != null  and tStatistics.rllb != ''">
                ${tStatistics.rllb}
            </if>
            <if test="tStatistics.jyjgmc != null  and tStatistics.jyjgmc != ''">
                ${tStatistics.jyjgmc}
            </if>
            <if test="tStatistics.jcjl != null  and tStatistics.jcjl != ''">
                ${tStatistics.jcjl}
            </if>
            <if test="tStatistics.jcrq != null  and tStatistics.jcrq != ''">
                ${tStatistics.jcrq}
            </if>
        </trim>
    </select>

</mapper>